---
title: "ProblemSet2_new"
author: "Ke-li Chiu & Diego Mamanche Castellanos"
date: "06/02/2020"
output: html_document
abstract: "Abstract nnnnn nnnnnn"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#Set up the environment

library(opendatatoronto)
library(dplyr)
library(tidyr)
library(tidyverse)
library(ggplot2)
library(knitr)
library(data.table) #Useful to transponse a dataframe
#install.packages("treemapify")
library(treemapify)
#install.packages("CAinterprTools")
library(CAinterprTools)

```

```{r}
#Set working Directory
#setwd("~/Experimental Design for Data Science/ProblemSet2")
#Import the dataset
#main_df <- read.csv("neighbourhood-profiles-2016-csv.csv")


# Search packages (this returns a table)
neighbourhood_packages <- search_packages("Neighbourhood")
### Filtering the neighbourhood demographic dataset
neighbourhood_demographics_package<- neighbourhood_packages %>%
  filter(title == "Neighbourhood Profiles")

```


```{r}
#Create main dataset for year 2011 
main_df_2011 <-  neighbourhood_demographics_package %>% # Start with the package 
  list_package_resources() %>% # List the resources in the package
  filter(name == "Neighbourhood Data 2001, 2006, 2011.xlsx") %>% # Only keep the resource we want 
  get_resource()
```

```{r}
#Create main dataset for year 2016 
main_df_2016 <-  neighbourhood_demographics_package %>% # Start with the package 
  list_package_resources() %>% # List the resources in the package
  filter(name == "neighbourhood-profiles-2016-csv") %>% # Only keep the resource we want 
  get_resource()
```

# First Dataset

```{r}
##### Distribution by education 2016####

#Filter education per neighbourhood
neighbourhood_columns_2016 <- main_df_2016[1:2, ]
neighbourhood_columns_2016 <- janitor::clean_names(neighbourhood_columns_2016)
neighbourhood_columns_2016

no_header_df_2016 <- main_df_2016[3:nrow(main_df_2016),]
no_header_df_2016 <- janitor::clean_names(no_header_df_2016)
no_header_df_2016

education_df_2016 <- filter(no_header_df_2016, category == "Education" & topic == "Major field of study - Classification of Instructional Programs (CIP) 2016")
names(education_df_2016)[names(education_df_2016) == "_id"] <- "id"


edu_25_64 <- filter(education_df_2016, characteristic == "Total - Major field of study - Classification of Instructional Programs (CIP) 2016 for the population aged 25 to 64 years in private households - 25% sample data")

education_df_2016 <- filter(education_df_2016, id < as.numeric(edu_25_64["id"]))


education_df_2016["characteristic"]

education_df_2016 <-
  education_df_2016 %>% 
    filter(!str_detect(characteristic, "^([ ]+[0-9]|Total)"))

education_df_2016 <- education_df_2016[,5:length(education_df_2016)]
education_df_2016

education_df_2016[,2:length(education_df_2016)] <- sapply(education_df_2016[,2:length(education_df_2016)], function(x) as.numeric(x))
education_df_2016


education_df_2016

```

```{r}
#Scale dataframe by column
scaled_education_df_2016 <- education_df_2016

scaled_education_df_2016 <-
  scaled_education_df_2016 %>%
    janitor::adorn_percentages(denominator = "col")

scaled_education_df_2016 <-
  scaled_education_df_2016 %>%
    janitor::adorn_rounding(digits = 3)



scaled_education_df_2016 <- as.data.frame(scaled_education_df_2016)
```

```{r}
#Reshape dataframe
col_names_2016 <- as.data.frame(colnames(scaled_education_df_2016))
col_names_2016 <- col_names_2016[2:nrow(col_names_2016),]
col_names_2016 <- as.data.frame(col_names_2016)
colnames(col_names_2016) <- "neighbourhoods"
col_names_2016

edu_df_2016_reshaped <- transpose(scaled_education_df_2016, make.names=1)
edu_df_2016_reshaped

edu_df_2016_reshaped <- mutate(edu_df_2016_reshaped, neighbourhoods = col_names_2016$neighbourhoods)

edu_df_2016_reshaped <- janitor::clean_names(edu_df_2016_reshaped)

edu_df_2016_reshaped <- select(edu_df_2016_reshaped, neighbourhoods, no_postsecondary_certificate_diploma_or_degree:other)

edu_df_2016_reshaped
```

#Second Dataset 2011

```{r}
##### Distribution by education 2011####


#Select sheet 2011
clean_header_df_2011 <- main_df_2011$`2011`

clean_header_df_2011 <- janitor::clean_names(clean_header_df_2011)

education_df_2011 <- filter(clean_header_df_2011, category == "Education" & topic == "Major field of study - Classification of Instructional Programs (CIP)")

education_df_2011 <-
  education_df_2011 %>% 
    filter(!str_detect(attribute, "Total"))

education_df_2011 <- education_df_2011[,3:length(education_df_2011)]

education_df_2011[,2:length(education_df_2011)] <- sapply(education_df_2011[,2:length(education_df_2011)], function(x) as.numeric(x))
education_df_2011


education_df_2011

```

```{r}
#Scale dataframe by column
scaled_education_df_2011 <- education_df_2011

scaled_education_df_2011 <-
  scaled_education_df_2011 %>%
    janitor::adorn_percentages(denominator = "col")

scaled_education_df_2011 <-
  scaled_education_df_2011 %>%
    janitor::adorn_rounding(digits = 3)



scaled_education_df_2011 <- as.data.frame(scaled_education_df_2011)
```

```{r}
#Reshape dataframe
col_names_2011 <- as.data.frame(colnames(scaled_education_df_2011))
col_names_2011 <- col_names_2011[2:nrow(col_names_2011),]
col_names_2011 <- as.data.frame(col_names_2011)
colnames(col_names_2011) <- "neighbourhoods"
col_names_2011

edu_df_2011_reshaped <- transpose(scaled_education_df_2011, make.names=1)
edu_df_2011_reshaped

edu_df_2011_reshaped <- mutate(edu_df_2011_reshaped, neighbourhoods = col_names_2011$neighbourhoods)

edu_df_2011_reshaped <- janitor::clean_names(edu_df_2011_reshaped)

edu_df_2011_reshaped <- select(edu_df_2011_reshaped, neighbourhoods, no_postsecondary_certificate_diploma_or_degree:other_fields_of_study)

edu_df_2011_reshaped
```

```{r}
?gather(edu_df_2011_reshaped, )

```
